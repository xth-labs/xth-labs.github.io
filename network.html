<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XTHEREON — Network</title>
  <link rel="stylesheet" href="assets/css/styles.css?v=4">
</head>

<body>

  <header class="nav-header">
    <nav class="nav">
      <a href="/" class="nav-logo">XTH</a>
      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/download.html">Download</a>
        <a href="/docs.html">Docs</a>
        <a href="/network.html">Network</a>
        <a href="/community.html">Community</a>
        <a href="https://github.com/xth-labs/xthereon">X-GitHub</a>
      </div>
    </nav>
  </header>

  <!-- PAGE HEADER -->
  <section class="page-header">
    <div class="page-header-inner">
      <h1>Network Overview</h1>
      <p>Live status of the XThereon blockchain — blocks, peers, and chain activity.</p>
    </div>
  </section>

  <!-- NETWORK STATUS -->
  <section class="network">
    <div class="network-inner">

      <h2 class="section-title">Network Status</h2>

      <div class="net-stats-grid">

        <div class="net-card">
          <span class="net-label">Block Height</span>
          <span class="net-value" id="stat-height">—</span>
        </div>

        <div class="net-card">
          <span class="net-label">Difficulty</span>
          <span class="net-value" id="stat-difficulty">—</span>
        </div>

        <div class="net-card">
          <span class="net-label">Hashrate</span>
          <span class="net-value" id="stat-hashrate">—</span>
        </div>

        <div class="net-card">
          <span class="net-label">Last Block</span>
          <span class="net-value" id="stat-lastblock">—</span>
        </div>

        <div class="net-card">
          <span class="net-label">Chain</span>
          <span class="net-value" id="stat-chain">—</span>
        </div>

      </div>

      <p class="net-note">
        Live data from an active XThereon node. Updates every 30 seconds.
      </p>

      <!-- RECENT BLOCKS -->
      <h2 class="section-title" style="margin-top:60px;">Recent Blocks</h2>

      <div class="blocks-table">

        <div class="blocks-row blocks-header">
          <div>Height</div>
          <div>Hash</div>
          <div>Age</div>
          <div>Reward</div>
          
        </div>

        <div id="blocks-body"></div>

      </div>

      <!-- PEERS -->
    

  <!-- LIVE NETWORK STATS SCRIPT -->
 <script>
let lastData = null;
let lastUpdateTs = 0;

async function fetchNetworkStats() {
  try {
    const res = await fetch('/stats/network.json?_=' + Date.now(), {
      cache: 'no-store'
    });
    if (!res.ok) throw new Error('Bad response');

    const data = await res.json();

    // basic sanity
    if (!data || !data.height) return;

    updateStat('stat-height', data.height);
    updateStat('stat-difficulty', Number(data.difficulty).toExponential(3));
    updateStat('stat-hashrate', formatHashrate(data.hashrate));
    updateStat('stat-chain', data.chain);

    // last block age
    const ageSecs = Math.max(
      0,
      Math.floor(Date.now() / 1000 - data.last_block_time)
    );
    const mins = Math.floor(ageSecs / 60);
    updateStat(
      'stat-lastblock',
      mins <= 0 ? 'just now' : `${mins} min ago`
    );

    // only re-render blocks if they changed
    if (
      !lastData ||
      JSON.stringify(lastData.recent_blocks) !==
        JSON.stringify(data.recent_blocks)
    ) {
      renderBlocks(data.recent_blocks, data.last_block_time);
    }

    lastData = data;
    lastUpdateTs = Date.now();

  } catch (e) {
    console.warn('Network stats unavailable (will retry)', e);
  }
}

function updateStat(id, value) {
  const el = document.getElementById(id);
  if (!el) return;

  if (el.textContent !== String(value)) {
    el.textContent = value;

    const card = el.closest('.net-card');
    if (card) {
      card.classList.remove('updated');
      void card.offsetWidth;
      card.classList.add('updated');
    }
  }
}

function formatHashrate(h) {
  if (h < 1e3) return `${Math.round(h)} H/s`;
  if (h < 1e6) return `${(h / 1e3).toFixed(2)} kH/s`;
  if (h < 1e9) return `${(h / 1e6).toFixed(2)} MH/s`;
  return `${(h / 1e9).toFixed(2)} GH/s`;
}

<script>
function renderBlocks(blocks, lastBlockTime) {
  const body = document.getElementById('blocks-body');
  if (!body || !Array.isArray(blocks)) return;

  body.innerHTML = '';

  const now = Math.floor(Date.now() / 1000);

  blocks.forEach((b, idx) => {
    // Estimate age assuming average block spacing
    const estAgeSecs = Math.max(0, now - lastBlockTime + idx * 60);
    const mins = Math.floor(estAgeSecs / 60);

    const ageLabel =
      mins <= 0
        ? 'just now'
        : mins === 1
        ? '1 min ago'
        : `${mins} min ago`;

    const row = document.createElement('div');
    row.className = 'blocks-row';

    row.innerHTML = `
      <div>#${b.height}</div>
      <div style="font-family:monospace">${b.hash.slice(0, 18)}…</div>
      <div>${ageLabel}</div>
      <div>50 XTH</div>
    
    `;

    body.appendChild(row);
  });
}
</script>

</body>
</html>
